<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Official Property Tax Notice</title>
<style>
    body {
        font-family: "Times New Roman", serif;
        background-color: #f7f7f7;
        margin: 40px;
        color: #2C3E50;
        line-height: 1.6;
    }
    .letter-container {
        max-width: 800px;
        margin: auto;
        padding: 30px 40px;
        background: #ffffff;
        border: 1px solid #dcdcdc;
        border-radius: 8px;
    }
    h2 {
        text-align: center;
        color: #b0322c;
        margin-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    h4 {
        margin: 20px 0 8px 0;
    }
    p { margin: 6px 0; }
    ul { margin-left: 20px; }
    .header-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
        font-size: 14px;
    }
    .highlight {
        font-weight: bold;
    }
    .tax-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        margin-bottom: 15px;
        font-size: 14px;
    }
    .tax-table th,
    .tax-table td {
        border: 1px solid #dcdcdc;
        padding: 6px 8px;
        text-align: left;
    }
    .tax-table th {
        background-color: #f1f1f1;
    }
    .tax-table tfoot td {
        font-weight: bold;
    }
    .status-badge {
        font-weight: bold;
        padding: 2px 6px;
        border-radius: 3px;
    }
    .status-paid {
        color: #155724;
        background-color: #d4edda;
        border: 1px solid #c3e6cb;
    }
    .status-unpaid {
        color: #721c24;
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
    }
    .status-partial {
        color: #856404;
        background-color: #fff3cd;
        border: 1px solid #ffeeba;
    }
    .buttons {
        margin-top: 20px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    .btn {
        display: inline-block;
        padding: 8px 18px;
        font-size: 14px;
        text-decoration: none;
        border-radius: 4px;
        border: none;
    }
    .btn-pay {
        background-color: #27AE60;
        color: #ffffff;
    }
    .btn-print {
        background-color: #2E86C1;
        color: #ffffff;
    }
    .footer {
        margin-top: 40px;
        font-size: 14px;
    }
</style>
</head>
<body>

<div class="letter-container">
    <h2>Official Property Tax Notice</h2>

    <div class="header-row">
        <div>
            <p><span class="highlight">To:</span> <span id="owner"></span></p>
            <p><span class="highlight">Address:</span> <span id="address"></span></p>
        </div>
        <div>
            <p><span class="highlight">Date:</span> <span id="currentDate"></span></p>
            <p><span class="highlight">Status:</span>
                <span id="statusBadge" class="status-badge"></span>
            </p>
        </div>
    </div>

    <p>Dear Sir/Madam,</p>

    <p id="noticeText"></p>

    <h4>Property & Contact Details</h4>
    <p><b>Owner:</b> <span id="owner2"></span></p>
    <p><b>Contact No.:</b> <span id="phone"></span></p>
    <p><b>Email:</b> <span id="email"></span></p>
    <p><b>Property Address:</b> <span id="address2"></span></p>
    <p><b>Carpet Area:</b> <span id="carpet"></span> m²</p>

    <h4>Tax Details</h4>
    <table class="tax-table">
        <thead>
            <tr>
                <th>Component</th>
                <th>Amount (₹)</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>General Tax</td>
                <td id="genTax"></td>
            </tr>
            <tr>
                <td>Water Tax</td>
                <td id="waterTax"></td>
            </tr>
            <tr>
                <td>Conservancy Tax</td>
                <td id="consTax"></td>
            </tr>
            <tr>
                <td>Education Cess</td>
                <td id="eduCess"></td>
            </tr>
            <tr>
                <td>Usage Charges</td>
                <td id="usageCharge"></td>
            </tr>
        </tbody>
        <tfoot>
            <tr>
                <td>Total Outstanding Amount</td>
                <td id="totalTax" style="color:#b0322c;"></td>
            </tr>
        </tfoot>
    </table>

    <h4>Instructions</h4>
    <ul id="instructions"></ul>

    <p id="closing"></p>

    <div class="buttons" id="buttonContainer">
        <a href="javascript:window.print()" class="btn btn-print">Print Notice</a>
        <!-- Pay Now button will be injected by JS if status != Paid -->
    </div>

    <div class="footer">
        <p>Sincerely,</p>
        <p><b>Property Tax Collection Officer</b><br>Municipal Corporation</p>
    </div>
</div>

<script>
    // --------- READ URL PARAMETERS (FROM ARCADE LINKS) ----------
    const urlParams = new URLSearchParams(window.location.search);

    const owner  = urlParams.get('owner')   || "N/A";
    const phone  = urlParams.get('phone')   || "N/A";
    const email  = urlParams.get('email')   || "N/A";
    const address = urlParams.get('address') || "N/A";
    const carpet = urlParams.get('carpet')  || "0";

    const totalTax = urlParams.get('totalTax') || "0";
    const status   = urlParams.get('status')   || "Unknown";

    // Detailed tax components (may be zero if not supplied)
    const genTax       = urlParams.get('genTax')       || "0";
    const waterTax     = urlParams.get('waterTax')     || "0";
    const consTax      = urlParams.get('consTax')      || "0";
    const eduCess      = urlParams.get('eduCess')      || "0";
    const usageCharge  = urlParams.get('usageCharge')  || "0";

    // --------- POPULATE BASIC FIELDS ----------
    document.getElementById("owner").innerText  = owner;
    document.getElementById("owner2").innerText = owner;
    document.getElementById("address").innerText = address;
    document.getElementById("address2").innerText = address;
    document.getElementById("phone").innerText  = phone;
    document.getElementById("email").innerText  = email;
    document.getElementById("carpet").innerText = carpet;

    document.getElementById("genTax").innerText      = genTax;
    document.getElementById("waterTax").innerText    = waterTax;
    document.getElementById("consTax").innerText     = consTax;
    document.getElementById("eduCess").innerText     = eduCess;
    document.getElementById("usageCharge").innerText = usageCharge;
    document.getElementById("totalTax").innerText    = totalTax;

    // Current date
    const today = new Date();
    const dd = String(today.getDate()).padStart(2, '0');
    const mm = String(today.getMonth() + 1).padStart(2, '0');
    const yyyy = today.getFullYear();
    document.getElementById("currentDate").innerText = dd + '/' + mm + '/' + yyyy;

    const fiscalYear = yyyy;

    // --------- STATUS BADGE ----------
    const statusBadge = document.getElementById("statusBadge");
    statusBadge.innerText = status;

    if (status === "Paid") {
        statusBadge.classList.add("status-paid");
    } else if (status === "Unpaid") {
        statusBadge.classList.add("status-unpaid");
    } else if (status === "Partially Paid") {
        statusBadge.classList.add("status-partial");
    }

    // --------- NOTICE TEXT & INSTRUCTIONS ----------
    const noticeTextEl = document.getElementById("noticeText");
    const instructionsEl = document.getElementById("instructions");
    const closingEl = document.getElementById("closing");

    if (status === "Unpaid") {
        noticeTextEl.innerHTML =
            `This is an official notice from the Municipal Corporation regarding the <b>outstanding property tax</b> for your property. ` +
            `Our records indicate that the payment for the fiscal year ${fiscalYear} has <span style="font-weight:bold; color:#b0322c;">NOT BEEN PAID</span>.`;

        instructionsEl.innerHTML = `
            <li>Please remit the outstanding amount of <b>₹${totalTax}</b> at the earliest to avoid penalties or legal proceedings.</li>
            <li>Payment can be made through the official online property tax portal using the button below or at the Municipal Corporation office.</li>
            <li>For any queries, kindly contact the Property Tax Department at <b>official@gov.in</b>.</li>
        `;

        closingEl.innerText =
            "Please treat this matter with urgency. Non-payment may result in further administrative action in accordance with municipal regulations.";
    }
    else if (status === "Partially Paid") {
        noticeTextEl.innerHTML =
            `This is an official notice from the Municipal Corporation regarding the <b>partial payment of property tax</b> for your property. ` +
            `For the fiscal year ${fiscalYear}, the payment status is recorded as <span style="font-weight:bold; color:#856404;">PARTIALLY PAID</span>.`;

        instructionsEl.innerHTML = `
            <li>The remaining balance of <b>₹${totalTax}</b> must be settled at the earliest to avoid penalties or legal proceedings.</li>
            <li>You may verify the balance on the official property tax portal or visit the Municipal Corporation office.</li>
            <li>For assistance, you may contact the Property Tax Department at <b>official@gov.in</b>.</li>
        `;

        closingEl.innerText =
            "We request your cooperation in clearing the remaining dues promptly to avoid further action.";
    }
    else if (status === "Paid") {
        noticeTextEl.innerHTML =
            `This is to acknowledge that the <b>property tax for the fiscal year ${fiscalYear}</b> has been <span style="font-weight:bold; color:#155724;">PAID IN FULL</span>. ` +
            `This notice is issued for your records.`;

        instructionsEl.innerHTML = `
            <li>No further payment is due for the above-mentioned fiscal year.</li>
            <li>You may retain this notice and the payment receipt for your future reference.</li>
        `;

        closingEl.innerText =
            "We thank you for your timely payment and cooperation.";
    }
    else {
        // Fallback for unknown status
        noticeTextEl.innerHTML =
            `This is an official communication regarding the property tax associated with your property. ` +
            `Please verify your payment status with the Municipal Corporation.`;

        instructionsEl.innerHTML = `
            <li>Kindly contact the Property Tax Department to confirm your outstanding amount, if any.</li>
        `;

        closingEl.innerText =
            "We request you to regularize any dues, if pending, at the earliest.";
    }

    // --------- ADD PAY NOW BUTTON (REDIRECT TO PAYMENT PAGE) ----------
    if (status !== "Paid") {
        const buttonContainer = document.getElementById("buttonContainer");

        // Construct payment URL (must match Arcade ConfirmPayment.html link)
        const payBaseUrl = "https://satyamkumarpge24339-netizen.github.io/Paldi_3D/ConfirmPayment.html";
        const payUrl = payBaseUrl
            + "?owner="   + encodeURIComponent(owner)
            + "&totalTax=" + encodeURIComponent(totalTax)
            + "&status="   + encodeURIComponent(status)
            + "&address="  + encodeURIComponent(address);

        const payBtn = document.createElement("a");
        payBtn.href = payUrl;
        payBtn.target = "_blank";
        payBtn.className = "btn btn-pay";
        payBtn.innerText = "Pay Now";

        buttonContainer.appendChild(payBtn);
    }
</script>

</body>
</html>
